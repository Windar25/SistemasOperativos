# 4.5 EXAMPLE FILE SYSTEMS

En las siguientes secciones discutiremos varios ejemplos de sistemas de archivos, desde los más simples a los más sofisticados. Dado que los sistemas de archivos UNIX modernos y el sistema de archivos nativo de Windows 8 se tratan en el capítulo sobre UNIX (Cap. 10) y en el capítulo sobre Windows 8 (Cap. 11), no trataremos esos sistemas aquí. Sin embargo, examinaremos sus predecesores a continuación.

## 4.5.1 The MS-DOS File System

El sistema de archivos MS-DOS es el que incorporaban los primeros ordenadores IBM. Fue el principal sistema de archivos hasta Windows 98 y Windows ME. Sigue siendo compatible con Windows 2000, Windows XP y Windows Vista, aunque ya no es estándar en los nuevos PC, excepto para los disquetes. Sin embargo, tanto esta como su extensión (FAT -32) se han generalizado en muchos sistemas integrados. La mayoría de las cámaras digitales lo utilizan. Muchos reproductores MP3 la utilizan exclusivamente. El popular iPod de Apple lo utiliza como sistema de archivos predeterminado, aunque los piratas informáticos pueden reformatear el iPod e instalar un sistema de archivos diferente. Por tanto, el número de dispositivos electrónicos que utilizan el sistema de archivos MS-DOS es mucho mayor ahora que en cualquier otro momento del pasado y, desde luego, mucho mayor que el número de los que utilizan el sistema de archivos NTFS, más moderno. Sólo por este motivo, merece la pena analizarlo en detalle.

Para leer un archivo, un programa MS-DOS debe realizar primero una llamada al sistemaopen para obtener el handle del mismo. La llamada al sistemaopen especifica una ruta, que puede ser absoluta o relativa al directorio de trabajo actual. La ruta se busca componente por componente hasta que se localiza el directorio final y se lee en memoria. A continuación, se busca el archivo que se desea abrir.

Aunque los directorios MS-DOS son de tamaño variable, utilizan una entrada de directorio de 32 bytes de tamaño fijo. En la Fig. 4-30 se muestra el formato de una entrada de directorio MS-DOS.  Contiene el nombre del archivo, atributos, fecha y hora de creación, bloque inicial y tamaño exacto del archivo. Los nombres de archivo de menos de 8 + 3 caracteres se justifican a la izquierda y se rellenan con espacios a la derecha, en cada campo por separado. El campo Atributos es nuevo y contiene bits para indicar que un fichero es de sólo lectura, necesita ser archivado, está oculto o es un fichero de sistema. Los archivos de sólo lectura no se pueden escribir. Esto es para protegerlos de daños accidentales. El bit archivado no tiene ninguna función real en el sistema operativo (es decir, MS-DOS no lo examina ni lo establece). La intención es permitir que los programas de archivo a nivel de usuario lo borren al archivar un fichero y que otros programas lo activen al modificar un fichero.  De este modo, un programa de copia de seguridad puede examinar este bit de atributo en cada archivo para ver de qué archivos debe realizar una copia de seguridad. El bit oculto se puede configurar para evitar que un archivo aparezca en los listados de directorios. Su uso principal es evitar confundir a los usuarios novatos con archivos que podrían no entender. Por último, el bit de sistema también oculta archivos.  Además, los archivos del sistema no pueden borrarse accidentalmente con el comando del. Los principales componentes de MS-DOS tienen este bit activado.

![figure4-30](https://github.com/gabo52/SistemasOperativos/blob/main/figures/Chapter4/figure4-30.png?raw=true)

La entrada del directorio también contiene la fecha y la hora en que se creó o modificó por última vez el archivo. La hora sólo tiene una precisión de ±2 segundos porque se almacena en un campo de 2 bytes, que sólo puede almacenar 65.536 valores únicos (un día contiene 86.400 segundos). El campo de la hora se subdivide en segundos (5 bits), minutos (6 bits) y horas (5 bits). La fecha se cuenta en días utilizando tres subcampos: día (5 bits), mes (4 bits) y año 1980 (7 bits). Con un número de 7 bits para el año y la hora a partir de 1980, el año más expresable es 2107. Por lo tanto, MS-DOS tiene un problema Y2108 incorporado. Para evitar catástrofes, los usuarios de MS-DOS deberían empezar a cumplir con Y2108 lo antes posible.  Si MS-DOS hubiera utilizado los campos combinados de fecha y hora como un contador de segundos de 32 bits, podría haber representado cada segundo exactamente y retrasado la catástrofe hasta 2116.

MS-DOS almacena el tamaño del archivo como un número de 32 bits, por lo que en teoría los archivos pueden ser de hasta 4 GB. Sin embargo, otros límites (descritos más adelante) restringen el tamaño máximo de los archivos a 2 GB o menos. Una parte sorprendentemente grande de la entrada (10 bytes) no se utiliza.

MS-DOS realiza un seguimiento de los bloques de archivos a través de una tabla de asignación de archivos en la memoria principal. Este número se utiliza como índice en una FAT de 64K entradas en la memoria principal. Siguiendo la cadena, se pueden encontrar todos los bloques. El funcionamiento de la FAT se ilustra en la Fig. 4-12.

El sistema de archivos FAT está disponible en tres versiones: FAT-12, FAT-16 y FAT-32, según el número de bits que contenga una dirección de disco. En realidad, FAT-32 es una denominación errónea, ya que sólo se utilizan los 28 bits de orden inferior de las direcciones de disco. Debería haberse llamado FAT-28, pero las potencias de dos suenan mucho mejor.

Otra variante del sistema de archivos FAT es exFAT , que Microsoft introdujo para dispositivos extraíbles de gran tamaño. Apple obtuvo la licencia de exFAT , de modo que existe un sistema de archivos moderno que puede utilizarse para transferir archivos en ambos sentidos entre ordenadores con Windows y OS X. Dado que exFAT es un sistema propietario y Microsoft no ha publicado la especificación, no hablaremos más de él aquí.

Para todas las FAT, el bloque de disco puede establecerse en algún múltiplo de 512 bytes (posiblemente diferente para cada partición), siendo el conjunto de tamaños de bloque permitidos (llamados **cluster sizes** por Microsoft) diferente para cada variante. La primera versión de MS-DOS usaba FAT -12 con bloques de 512 bytes, dando un tamaño máximo de partición de 212× 512bytes (en realidad sólo 4086 × 512 bytes porque 10 de las direcciones de disco se usaban como marcadores especiales, como fin de archivo, bloque defectuoso, etc.). Con estos parámetros, el tamaño máximo de la partición de disco era de unos 2 MB y el tamaño de la tabla FAT en memoria era de 4096 entradas de 2 bytes cada una. Utilizar una entrada de tabla de 12 bits habría sido demasiado lento.

Este sistema funcionaba bien con los disquetes, pero cuando aparecieron los discos duros, se convirtió en un problema. Microsoft resolvió el problema permitiendo tamaños de bloque adicionales de 1 KB, 2 KB y 4 KB. Este cambio conservaba la estructura y el tamaño de la tabla FAT-12, pero permitía particiones de disco de hasta 16 MB.

Dado que MS-DOS admitía cuatro particiones por unidad de disco, el nuevo sistema de archivos FAT -12 funcionaba hasta en discos de 64 MB. A partir de ahí, algo tenía que cambiar. Lo que ocurrió fue la introducción de FAT -16, con punteros de disco de 16 bits. Además, se permitían tamaños de bloque de 8 KB, 16 KB y 32 KB. (32.768 es la mayor potencia de dos que se puede representar en 16 bits.) La tabla FAT -16 ocupaba ahora 128 KB de memoria principal todo el tiempo, pero con las memorias más grandes de las que se disponía entonces, se utilizó ampliamente y sustituyó rápidamente al sistema de archivos FAT -12. La partición de disco más grande que puede soportar FAT -16 es de 2 GB (entradas de 64K de 32 KBcada una) y el disco más grande, de 8 GB, es decir, cuatro particiones de 2 GB cada una. Durante bastante tiempo, eso fue suficiente.

Pero no para siempre. Para las cartas comerciales, este límite no es un problema, pero para almacenar vídeo digital utilizando el estándar DV, un archivo de 2 GB contiene poco más de 9 minutos de vídeo. Como consecuencia del hecho de que un disco de PC sólo admite cuatro particiones, el vídeo más grande que se puede almacenar en un disco es de unos 38 minutos, independientemente de lo grande que sea el disco. Este límite también significa que el vídeo más grande que se puede editar en línea es inferior a 19 minutos, ya que se necesitan tanto archivos de entrada como de salida.

A partir de la segunda versión de Windows 95, se introdujo el sistema de archivos FAT -32, con sus direcciones de disco de 28 bits, y la versión de MS-DOS subyacente a Windows 95 se adaptó para soportar FAT -32. En este sistema, las particiones podrían ser teóricamente de 228× 215bytes, pero en realidad están limitadas a 2 TB (2048 GB) porque internamente el sistema lleva la cuenta del tamaño de las particiones en sectores de 512 bytes usando un número de 32 bits, y 29× 232 son 2 TB. En la Fig. 4-31 se muestra el tamaño máximo de partición para varios tamaños de bloque y los tres tipos de FAT.


![figure4-31](https://github.com/gabo52/SistemasOperativos/blob/main/figures/Chapter4/figure4-31.png?raw=true)

Además de admitir discos más grandes, el sistema de archivos FAT -32 tiene otras dos ventajas sobre FAT -16. La primera es que un disco de 8 GB que utilice FAT -32 puede tener una sola partición.  En primer lugar, un disco de 8 GB con FAT -32 puede ser una sola partición, mientras que con FAT -16 tiene que tener cuatro particiones, que para el usuario de Windows son las unidades de disco lógicas C:, D:, E: y F:.  Depende del usuario decidir qué archivo colocar en cada unidad y llevar la cuenta de lo que hay en cada una.   

La otra ventaja de FAT-32 sobre FAT-16 es que para una partición de disco de un tamaño determinado, se puede utilizar un tamaño de bloque más pequeño. Por ejemplo, para una partición de disco de 2 GB, FAT-16 debe utilizar bloques de 32 KB; de lo contrario, con sólo 64 KB de direcciones de disco disponibles, no puede cubrir toda la partición. Por el contrario, FAT -32 puede utilizar, por ejemplo, bloques de 4 KB para una partición de disco de 2 GB. La ventaja del tamaño de bloque más pequeño es que la mayoría de los archivos son mucho más cortos que 32 KB. Si el tamaño de bloque es de 32 KB, un archivo de 10 bytes ocupa 32 KB de espacio en disco. Si el archivo medio es, digamos, de 8 KB, con un bloque de 32 KB se desperdiciarán tres cuartas partes del disco, lo que no es una forma muy eficiente de utilizarlo. Con un archivo de 8 KB y un bloque de 4 KB, no hay desperdicio de disco, pero el precio a pagar es más RAM consumida por la FAT. Con un bloque de 4 KB y una partición de disco de 2 GB, hay 512K bloques, por lo que la FAT debe tener 512K entradas en memoria (ocupando 2 MB de RAM).

MS-DOS utiliza la FAT para realizar un seguimiento de los bloques de disco libres. Cualquier bloque que no este actualmente asignado es marcado con un codigo especial. Cuando MS-DOS necesita un nuevo bloque de disco, busca en la FAT una entrada que contenga este codigo. Por lo tanto, no se necesita un mapa de bits ni una lista libre.

## 4.5.2.The UNIX V7 File System

Incluso las primeras versiones de UNIX tenían un sistema de ficheros multiusuario bastante sofisticado, ya que derivaba de MULTICS.  A continuación discutiremos el sistema de ficheros V7, el del PDP-11 que hizo famoso a UNIX.  Examinaremos un sistema de archivos UNIX moderno en el contexto de Linux en el Cap. 10.    

El sistema de archivos adopta la forma de un árbol que comienza en el directorio raíz y al que se añaden links, formando un grafo acícilico dirigido. Los nombres de archivo pueden tener hasta 14 caracteres excepto '/'(porque este es el separador entre componentes en el PATH) y NULL(porque este es usado para rellenar los nombres de menos de 14 caracteres) NULL tiene el valor númeric de 0.
